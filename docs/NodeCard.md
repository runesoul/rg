# ğŸ“„ NodeCard åˆçº¦æŠ€æœ¯æ–‡æ¡£

## åˆçº¦æ¦‚è¿°

`NodeCard` æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è´­ä¹°èŠ‚ç‚¹å¡(Node Card)çš„æ™ºèƒ½åˆçº¦ï¼ŒåŸºäº BNB Chain å®ç°ï¼Œæ”¯æŒç»ç”± Oracle ç­¾åçš„ä»£å¸æ”¯ä»˜è´­ä¹°æ“ä½œï¼Œå¹¶æ”¯æŒ BNB ä»˜è´¹ã€‚

---

## åŸºæœ¬å‚æ•°

| å‚æ•°                   | å«ä¹‰                                                 |
| ---------------------- | ---------------------------------------------------- |
| `oracle`               | ç”¨äºéªŒç­¾çš„ç­¾åè€…åœ°å€ï¼Œä»…æœ‰è¯¥åœ°å€ç­¾åæœ‰æ•ˆ             |
| `vault`                | èµ„é‡‘æ”¶æ¬¾åœ°å€ï¼Œç”¨äºæ”¶åˆ° ERC20 å’Œ BNB                  |
| `BNB_FEE`              | æŒ‡å®šç´¯è®¡è´­ä¹°éœ€æ”¯ä»˜çš„ BNB æ‰‹ç»­è´¹ï¼ˆé»˜è®¤ 0.0001 etherï¼‰ |
| `usedPurchaseContexts` | å·²ä½¿ç”¨çš„è´­ä¹°ä¸Šä¸‹æ–‡æ ‡è¯†ï¼Œç”¨äºé˜²æ­¢é‡å¤                 |

---

## æ ¸å¿ƒé€»è¾‘

### è´­ä¹°èŠ‚ç‚¹å¡ `purchase()`

1. æ ¡éªŒ tokenAddrList å’Œ tokenAmountList é•¿åº¦åŒ¹é…
2. æ ¡éªŒè´­ä¹°æœªè¿‡æœŸï¼ˆæ¯”å¯¹ `deadline`ï¼‰
3. æ ¡éªŒå……è¶³çš„ BNB è´¹ç”¨
4. æ ¡éªŒ `purchaseContext` æœªè¢«ä½¿ç”¨è¿‡
5. è§£æ signature å¾—åˆ° v, r, s
6. æ„é€ ç­¾åæ¨¡æ‹Ÿæ•°æ®ï¼Œå¹¶æ ¡éªŒ oracle æ˜¯å¦æ˜¯ç­¾åè€…
7. å¯¹æ‰€æœ‰ tokenAddrList[i] æ‰§è¡Œ `safeTransferFrom(msg.sender, vault, tokenAmountList[i])`
8. å°† BNB_FEE è½¬å…¥ vault
9. å¦‚æœ msg.value > BNB_FEEï¼Œé€€è¿˜å¤šä½™ BNB
10. è®°å½• purchaseContext å·²ä½¿ç”¨ï¼Œå¹¶ emit `NodeCardPurchased`

---

## ä¸»è¦åŠŸèƒ½

### ç­¾åæ ¡éªŒ

- é€šè¿‡ ECDSA éªŒè¯ç”¨æˆ·æä¾›çš„ signature æ˜¯å¦æ¥è‡ªæŒ‡å®š oracle åœ°å€
- æ•°æ®æ•´åˆæ–¹å¼ï¼š`abi.encodePacked(user, tokenAddrList, tokenAmountList, purchaseContext, deadline)`

### é˜²é‡å¤

- `purchaseContext` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œæ— æ³•é‡å¤ä½¿ç”¨ï¼Œé˜²æ­¢é‡å¤å’Œé‡æ”¶ä»˜

### è´¹ç”¨å¤„ç†

- éœ€è¦æ”¯ä»˜æŒ‡å®šçš„ `BNB_FEE`ï¼Œä¸Šé™å¤šç»™éƒ¨åˆ†é€€è¿˜

### å¼€æ”¾é…ç½®

- `setOracle` / `setVault` å¯ç”± owner é…ç½® oracle å’Œ vault åœ°å€
- `emergencyWithdraw` å…è®¸ owner æŠ½ç¦» vault ä¸­çš„ token æˆ– BNB

---

## äº‹ä»¶

| äº‹ä»¶                | å«ä¹‰                                                           |
| ------------------- | -------------------------------------------------------------- |
| `NodeCardPurchased` | æˆåŠŸè´­ä¹°èŠ‚ç‚¹å¡æ—¶è§¦å‘ï¼ŒåŒ…å«ç”¨æˆ·ã€token åˆ—è¡¨ã€ä»˜è´¹ã€timestamp ç­‰ |
